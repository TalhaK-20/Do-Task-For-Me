<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Do Task For Me | Login</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css'>
    <link rel="stylesheet" href="./css/user/login-signup-user.css">
    <link rel="icon" href="/images/logo.jpg" type="image/jpeg">

    <style>

        #username-container input {
            background-color: #eee;
            border: none;
            padding: 12px 15px;
            margin: 8px 0;
            width: 143%;
            position: relative;
            right: 41px;
        }

        #username-container .error {
            position: absolute;
            bottom: 80px;
            left: 53px;
            width: 72%;
            color: rgb(255, 255, 255);
            font-size: 0.8em;
            display: none;
            animation: fadeIn 0.2s ease-in-out;
            border-radius: 14px;
            border: 1px solid #ff8989;
            background-color: #ff8989;
        }

        #username-container input.error {
            border: 2px solid red;
        }

        #email-container input {
            background-color: #eee;
            border: none;
            padding: 12px 15px;
            margin: 8px 0;
            width: 143%;
            position: relative;
            right: 41px;
        }

        #email-container .error {
            position: absolute;
            bottom: 80px;
            left: 53px;
            width: 72%;
            color: rgb(255, 255, 255);
            font-size: 0.8em;
            display: none;
            animation: fadeIn 0.2s ease-in-out;
            border-radius: 14px;
            border: 1px solid #ff8989;
            background-color: #ff8989;
        }

        #email-container input.error {
            border: 2px solid red;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #signupForm button {
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #signupForm button.hidden {
            opacity: 0;
            visibility: hidden;
            position: relative;
            top: 100px;
        }
    
    </style>

</head>
<body>

<div class="container" id="container">
    <div class="form-container sign-up-container">
        
        
        <div id="signup-form">
            
            
            <form id="signupForm" action="/signup-user" method="POST">
                <h1 style="color: #06234A;">Create Account</h1>
                <div class="social-container">
                    <!-- <a href="#" class="social"><i class="fab fa-facebook-f"></i></a> -->
                    <a href="/auth/google" class="social"><i class="fab fa-google-plus-g"></i></a>
                    <!-- <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a> -->
                </div>
        
                <span>or use your email for registration</span>
                <!-- <input type="text" placeholder="Name" name="name" autocomplete="name" required> -->
                <div id="username-container">
                    <input type="text" placeholder="Username" name="username" id="usernameSignup" autocomplete="username" required>
                    <p id="username-error" class="error" style="display: none;">Username already exists. Please try a different username</p>
                </div>
                
                <div id="email-container">
                    <input type="email" placeholder="Email" name="email" autocomplete="email" id="emailSignup" autocomplete="username" required>
                    <p id="email-error" class="error" style="display: none;">Email already exists. Please try a different email</p>
                </div>
                
                <input type="password" placeholder="Password" name="password" autocomplete="current-password" required>
                <button type="submit">Sign Up</button>
            </form>
        </div>
    </div>










    <div class="form-container sign-in-container">
        
        <div id="login-form">
            
            
            <form action="/login-user" method="POST">
                <h1 style="color: #06234A;">Log In</h1>
                <div class="social-container">
                    <!-- <a href="/auth/facebook" class="social"><i class="fab fa-facebook-f"></i></a> -->
                    <a href="/auth/google" class="social"><i class="fab fa-google-plus-g"></i></a>
                    <!-- <a href="/auth/linkedin" class="social"><i class="fab fa-linkedin-in"></i></a> -->
                </div>
            
                <span>or use your account</span>
                <!-- <input type="text" placeholder="Username" name="username" autocomplete="username"> -->
                <input type="email" placeholder="Email" name="email" autocomplete="email" required>
                <input type="password" placeholder="Password" name="password" autocomplete="current-password">
                <a href="#" onclick="toggleForm('reset-password-form')">Forgot your password?</a>
                <button type="submit">Log In</button>
            </form>
        </div>
    </div>
    









    <div class="overlay-container">
        <div class="overlay">
            
            
            <div class="overlay-panel overlay-left">
                <h1>Returning Customer</h1>
                <p>To manage your orders and to keep connected with us please login with your personal info</p>
                <button class="ghost" id="signInOverlay">Log In</button>
            </div>
            
            
            <div class="overlay-panel overlay-right">
                <h1>New Customer</h1>
                <p>Enter your personal details and start your journey with us</p>
                <button class="ghost" id="signUpOverlay">Create Account</button>
            </div>
        </div>
    </div>
</div>










<div id="reset-password-form-container">
    <h2 id="Resetify"></h2>
    
    <form action="/reset-password-user" method="POST">
        <!-- <input type="text" placeholder="Username" name="username" autocomplete="username"> -->
        <input type="email" placeholder="Email" name="email" autocomplete="email" required>
        <button type="submit">Reset Password</button>
    </form>
    
    <p>Remembered your password? <a href="#" onclick="toggleForm('login-form')">Login</a></p>
</div>










<script>

    document.addEventListener('DOMContentLoaded', function() {
    fetch('/check-login-status', { credentials: 'same-origin' })
        .then(response => response.json())
        .then(data => {
    
            if (data.loggedIn) {
                window.location.href = '/user-dashboard';
            }
        })
     
        .catch(error => console.error('Error checking login status:', error));
});
    

    const signUpButton = document.getElementById('signUpOverlay');
    const signInButton = document.getElementById('signInOverlay');
    const container = document.getElementById('container');


    signUpButton.addEventListener('click', () => {
        container.classList.add("right-panel-active");
    });


    signInButton.addEventListener('click', () => {
        container.classList.remove("right-panel-active");
    });


    function toggleForm(formId) {
        var count = 0;
        var container = document.getElementById('container');
        var resetPasswordFormContainer = document.getElementById('reset-password-form-container');

        if (formId === 'reset-password-form') {
            container.classList.add('hidden');
            resetPasswordFormContainer.style.display = 'flex';
    
            if (count == 0) {
                typeWelcomeMessage();
            }
           
            count++;
        } 
        
        else {
            container.classList.remove('hidden');
            resetPasswordFormContainer.style.display = 'none';
            if (formId === 'login-form') {
                container.classList.remove("right-panel-active");
            } 
            
            else if (formId === 'signup-form') {
                container.classList.add("right-panel-active");
            }
        }
    }

    
    // Live check for username availability
    document.getElementById('usernameSignup').addEventListener('input', async function (e) {
        const username = e.target.value;
        const usernameError = document.getElementById('username-error');
        const signUpButton = document.querySelector('#signupForm button');

        if (username.length > 0) {
            const response = await fetch(`/check-username?username=${username}`);

            const result = await response.json();

            if (result.exists) {
                usernameError.style.display = 'block';
                signUpButton.classList.add('hidden');
            } 
            
            else {
                usernameError.style.display = 'none';
                signUpButton.classList.remove('hidden');
            }
        } 
        
        else {
            usernameError.style.display = 'none';
            signUpButton.classList.remove('hidden');
        }
    });


    // Handle form submission and check for username existence without page reload
    document.getElementById('signupForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const username = e.target.username.value;
        const usernameError = document.getElementById('username-error');
        const signUpButton = document.querySelector('#signupForm button');

        const response = await fetch(`/check-username?username=${username}`);
        const result = await response.json();

        if (result.exists) {
            usernameError.style.display = 'block';
            signUpButton.classList.add('hidden');
        } 
        
        else {
            usernameError.style.display = 'none';
            signUpButton.classList.remove('hidden');
            e.target.submit();
        }
    });


    // Live check for email availability
    document.getElementById('emailSignup').addEventListener('input', async function (e) {
        const email = e.target.value;
        const emailError = document.getElementById('email-error');
        const signUpButton = document.querySelector('#signupForm button');

        if (email.length > 0) {
            const response = await fetch(`/check-email?email=${email}`);

            const result = await response.json();

            if (result.exists) {
                emailError.style.display = 'block';
                signUpButton.classList.add('hidden');
            } 
            
            else {
                emailError.style.display = 'none';
                signUpButton.classList.remove('hidden');
            }
        } 
        
        else {
            emailError.style.display = 'none';
            signUpButton.classList.remove('hidden');
        }
    });


    document.getElementById('signupForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const email = e.target.email.value;
        const emailError = document.getElementById('email-error');
        const signUpButton = document.querySelector('#signupForm button');

        const response = await fetch(`/check-email?email=${email}`);
        const result = await response.json();

        if (result.exists) {
            emailError.style.display = 'block';
            signUpButton.classList.add('hidden');
        } 
        
        else {
            emailError.style.display = 'none';
            signUpButton.classList.remove('hidden');
            e.target.submit();
        }
    });


    function typeWelcomeMessage() {
        const usernameHeading = document.getElementById('Resetify');
        const welcomeText = 'Reset Password';
        const typingSpeed = 80; // Speed of typing in milliseconds
        let charIndex = 0;

        usernameHeading.textContent = ''; // Clear any existing text

        function type() {
            if (charIndex < welcomeText.length) {
                usernameHeading.textContent += welcomeText.charAt(charIndex);
                charIndex++;
                setTimeout(type, typingSpeed);
            }
        }

        type();
    }

</script>
</body>
</html>